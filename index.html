// --- ANNOUNCEMENTS ---
const POSTS_KEY = 'family_posts_v1';
function getPosts() { return JSON.parse(readStore(POSTS_KEY) || '[]'); }
function setPosts(v) { writeStore(POSTS_KEY, JSON.stringify(v)); renderPosts(); }

function renderPosts() {
  const wrap = $('#posts');
  wrap.innerHTML = '';
  const posts = getPosts();
  if (!posts.length) {
    const empty = document.createElement('div');
    empty.className = 'meta';
    empty.textContent = 'No announcements yet. Be the first to post!';
    wrap.appendChild(empty);
    return;
  }
  posts.forEach(p => {
    const card = document.createElement('div');
    card.className = 'person';
    card.innerHTML = `
      <div class="row"><strong>${p.title}</strong><span class="meta">${new Date(p.ts).toLocaleString()}</span></div>
      <div class="meta">${p.body}</div>
      <div class="row">
        ${p.author ? `<span class="meta">â€” ${p.author}</span>` : '<span></span>'}
        <button class="btn" onclick='deletePost("${p.id}")'>Delete</button>
      </div>
    `;
    wrap.appendChild(card);
  });
}

function newPost() {
  const title = prompt('Announcement title'); if (!title) return;
  const body = prompt('What\'s the update?'); if (!body) return;
  const author = prompt('Your name (optional)') || '';
  const posts = getPosts();
  posts.unshift({ id: uuid(), title, body, author, ts: Date.now() });
  setPosts(posts);
}

function deletePost(id) {
  if (!confirm('Delete this announcement?')) return;
  setPosts(getPosts().filter(x => x.id !== id));
}

$('#newPost').addEventListener('click', newPost);
